
{% extends "base.html" %}

{% block title %}Twilio Services - GEM Enterprise{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Twilio Communication Services</h1>
    
    <div class="row">
        <div class="col-md-12">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h3>Service Status</h3>
                </div>
                <div class="card-body">
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Twilio Configured
                            <span class="badge {% if services.twilio_configured %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                                {% if services.twilio_configured %}Active{% else %}Inactive{% endif %}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Phone Number
                            <span class="badge bg-info rounded-pill">{{ services.phone_number }}</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            SMS Service
                            <span class="badge {% if services.sms_enabled %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                                {% if services.sms_enabled %}Enabled{% else %}Disabled{% endif %}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            WhatsApp Service
                            <span class="badge {% if services.whatsapp_enabled %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                                {% if services.whatsapp_enabled %}Enabled{% else %}Disabled{% endif %}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Voice Calls
                            <span class="badge {% if services.voice_enabled %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                                {% if services.voice_enabled %}Enabled{% else %}Disabled{% endif %}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Phone Verification (2FA)
                            <span class="badge {% if services.verify_enabled %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                                {% if services.verify_enabled %}Enabled{% else %}Disabled{% endif %}
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Send SMS</h4>
                </div>
                <div class="card-body">
                    <form id="smsForm">
                        <div class="mb-3">
                            <label for="smsTo" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="smsTo" placeholder="+1234567890" required>
                        </div>
                        <div class="mb-3">
                            <label for="smsMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="smsMessage" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Send SMS</button>
                    </form>
                    <div id="smsResult" class="mt-3"></div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Make Voice Call</h4>
                </div>
                <div class="card-body">
                    <form id="callForm">
                        <div class="mb-3">
                            <label for="callTo" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="callTo" placeholder="+1234567890" required>
                        </div>
                        <div class="mb-3">
                            <label for="callMessage" class="form-label">Voice Message</label>
                            <textarea class="form-control" id="callMessage" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Make Call</button>
                    </form>
                    <div id="callResult" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h4>API Endpoints</h4>
                </div>
                <div class="card-body">
                    <ul class="list-group">
                        <li class="list-group-item"><code>POST /api/twilio/send-sms</code> - Send SMS message</li>
                        <li class="list-group-item"><code>POST /api/twilio/send-whatsapp</code> - Send WhatsApp message</li>
                        <li class="list-group-item"><code>POST /api/twilio/make-call</code> - Initiate voice call</li>
                        <li class="list-group-item"><code>POST /api/twilio/verify-phone</code> - Send OTP verification</li>
                        <li class="list-group-item"><code>POST /api/twilio/verify-check</code> - Verify OTP code</li>
                        <li class="list-group-item"><code>POST /api/twilio/webhook</code> - Incoming message webhook</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// SMS Form Handler
document.getElementById('smsForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const to = document.getElementById('smsTo').value;
    const message = document.getElementById('smsMessage').value;
    
    try {
        const response = await fetch('/api/twilio/send-sms', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ to, message })
        });
        const data = await response.json();
        document.getElementById('smsResult').innerHTML = 
            `<div class="alert alert-success">SMS sent! SID: ${data.sid}</div>`;
    } catch (error) {
        document.getElementById('smsResult').innerHTML = 
            `<div class="alert alert-danger">Error: ${error.message}</div>`;
    }
});

// Call Form Handler
document.getElementById('callForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const to = document.getElementById('callTo').value;
    const message = document.getElementById('callMessage').value;
    
    try {
        const response = await fetch('/api/twilio/make-call', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ to, message })
        });
        const data = await response.json();
        document.getElementById('callResult').innerHTML = 
            `<div class="alert alert-success">Call initiated! SID: ${data.sid}</div>`;
    } catch (error) {
        document.getElementById('callResult').innerHTML = 
            `<div class="alert alert-danger">Error: ${error.message}</div>`;
    }
});
</script>
{% endblock %}
